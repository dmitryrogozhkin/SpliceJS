"use strict";

class EventTarget {
    constructor(){

    }
}

/**
 *
 */
class Node extends EventTarget {
  constructor(name) {
    super();
    this.childNodes = [];
    this.nodeName = name;
  }

  appendChild(child){
    this.childNodes.push(child);
  }
}

/**
 *
 */
class Element extends Node {
  constructor(name) {
    super(name);
    this.attributes = {};
  }
  getAttribute(attrName){
    return this.attributes[attrName];
  }
  setAttribute(attrName, attrValue){
    this.attributes[attrName] = attrValue;
  }
}

/**
 *
 */
class HTMLHeadElement extends Node {
    constructor(){
        super('head');
    }

    appendChild(child){
        super.appendChild(child);
        if(child instanceof HTMLScriptElement){
            if(child.getAttribute('sjs-start-mode') == 'console') return;
            if(child.src){
                require(child.src);
                //run this asyncronously
                child.onload();
            }
        }
    }
}


/**
 *
 */
class HTMLBodyElement extends Node {
   constructor(){
       super('body');
   }
}


/**
 *
 */
class HTMLScriptElement extends Element {
    constructor(){
        super('script');
        //callback delegate
        this.onload = null;
    }

    setAttribute(attr,value){
        super.setAttribute(attr,value);
        if(attr == 'src') this.src = value;
    }
}

/**
*/
class Document {
  constructor() {
    this.head = new HTMLHeadElement('head');
    this.body = new HTMLBodyElement('body');
  }

  getElementsByTagName(tagName){
    if(tagName == 'head') return [this.head];
    return [];
  }

  createElement(elementName){
      if(elementName == 'script') {
          return new HTMLScriptElement();
      }
  }
}

/*
  Configure document based on the command line arguments input
*/
var document = new Document();

var script = new HTMLScriptElement('script');
script.setAttribute('src', process.argv[1]);
script.setAttribute('sjs-main',process.argv[2]);
script.setAttribute('sjs-start-mode','console');
document.head.appendChild(script);
module.exports = document;
